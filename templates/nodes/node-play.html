{% load staticfiles %}
{% load i18n %}
{% load humanize %}
{% load custom_tags %}


<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en" class="play-page">

	<head>
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-128952248-2"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());

		  gtag('config', 'UA-128952248-2');
		</script>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="generator" content="">
		<meta name="author" content="Yane Frenski">

		<meta charset="UTF-8">
	  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	  <meta name="keywords" content="{% trans "interactive, education, knowledge, game, quiz, learn, AI, artificial intelligence" %}" />
	  <meta name="description" content="{% trans "Fikra allows you create educational games with AI, distribute them, and have a more engaging and efficient learning experience" %}">
	  <link rel="shortcut icon" href="icons/favicon.ico" type="image/x-icon">
	  <link rel="icon" href="{% static '' %}img/icons/favicon.ico" type="image/x-icon">
	  <link rel="apple-touch-icon" href="{% static '' %}img/icons/apple-touch-icon.png">
	  <link rel="apple-touch-icon" sizes="72x72" href="{% static '' %}img/icons/apple-touch-icon-72x72.png">
	  <link rel="apple-touch-icon" sizes="114x114" href="{% static '' %}img/icons/apple-touch-icon-114x114.png">

	  <link rel="stylesheet" type="text/css" href="{% static "css/games-play.css" %}">

		<title>{{node.title}}</title>

	</head>

	<body class="">

		<div id="games-container" class="games-container-{{node.engine}}">
			<iframe id="games-container-if" title="{{node.title}}" src="{{ifr_url}}" {% if ifr_height %} height="{{ifr_height}}" {% endif %} allow="fullscreen *; clipboard-write *" ></iframe>
		</div>

		 <div id="branding"><a href="{{site_url}}" target="_blank"><img src="{% static "img/logomark-vizipedia.svg" %}"></a></div>

	</body>

  {% get_current_language as LANGUAGE_CODE %}
  <script type="text/javascript">
    const _USER_LANG = "{{LANGUAGE_CODE}}";
  </script>

  <script src="{% static "js/utils.js" %}" type="text/javascript"></script>

  <script type="text/javascript">

    const lId = {{use_log_new_id}};
    let trackingData = {};
    let logComplete = false;

    VP_TRACK_DELEGATE = {
      'setComplete': function() {
        logComplete = true;
      },
      'setTrackingValue': function(k, v) {
        trackingData[k] = v;
      },
    }

    const start_time = new Date();

    document.addEventListener('visibilitychange', function(e) {

      if (lId !== null) {

        const finish_time = new Date();

        if (document.visibilityState == 'hidden') {
          data = new FormData();
          const input = {
            'lid':lId,
            'finished_at': finish_time,
            'usage_time': (finish_time - start_time)/1000,
            'completed': logCompleted,
            'trackingData': trackingData
          };
          // token = $('meta[name="csrf-token"]').attr('content');
          data.append("input", JSON.stringify(input));
          data.append("csrfmiddlewaretoken", cookies['csrftoken']);
          navigator.sendBeacon("/node_update_use_log/", data);
        }
      }

  });

  </script>

</html>
